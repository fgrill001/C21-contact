<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>C21 Consultant Companion</title>
<link rel="manifest" href="./manifest.webmanifest"/>
<link rel="apple-touch-icon" href="./apple-touch-icon.png"/>
<meta name="theme-color" content="#111111"/>
<style>
:root{--gold:#BEAF87;--bg:#0f0f10;--panel:#161616;--border:#2a2a2a;--text:#fff;--muted:#9a9a9a}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.wrap{max-width:520px;margin:0 auto;padding:16px}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:0 12px 36px rgba(0,0,0,.35)}
.brandbar{display:flex;gap:12px;align-items:center;padding:14px 16px;background:#121212;border-bottom:1px solid var(--border)}
.badge{width:48px;height:48px;border-radius:12px;background:var(--gold);display:grid;place-items:center;color:#111;font-weight:900;text-align:center;line-height:1}
.section{padding:14px 16px;border-top:1px solid var(--border)}
label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
input{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:#0f0f0f;color:var(--text)}
.btn{width:100%;display:flex;justify-content:center;align-items:center;gap:8px;padding:12px;border-radius:12px;font-weight:700;text-decoration:none;cursor:pointer;border:1px solid transparent;margin-top:10px}
.primary{background:var(--gold);color:#111}
.secondary{background:#232323;color:#fff;border-color:#333}
.tertiary{background:#1b1b1b;color:#fff;border:1px dashed #333}
.hint{font-size:12px;color:var(--muted);margin-top:6px}
.footer{text-align:center;font-size:11px;color:#777;padding:12px}
.idbar{display:flex;gap:8px;align-items:center}
.avatar{width:44px;height:44px;border-radius:50%;border:2px solid var(--gold);background:#0f0f0f;background-size:cover;background-position:center}
.ro{background:#101010;border:1px dashed #333;padding:10px;border-radius:10px}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
</style>
<script>
// Fill to enable Supabase. Leave blank to use local JSON.
window.CONFIG = {
  SUPABASE_URL: "",
  SUPABASE_ANON: ""
};
</script>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <div class="brandbar">
      <div class="badge">me@<br/>C21</div>
      <div>
        <b>C21 Consultant Companion</b>
        <div style="font-size:12px;color:#9a9a9a">Share your card with clients ‚Äî instantly</div>
      </div>
    </div>
    <div class="section">
      <div class="idbar">
        <div class="avatar" id="myAvatar"></div>
        <div>
          <div style="font-weight:800;color:var(--gold)" id="myName">My name</div>
          <div style="font-size:12px;color:var(--muted)" id="myEmail">My email</div>
        </div>
      </div>
    </div>
    <div class="section">
      <label>My phone</label>
      <div id="myPhone" class="ro mono">+351 ...</div>
    </div>
    <div class="section">
      <label>My card link</label>
      <div id="myCard" class="ro mono">https://...</div>
    </div>
    <div class="section">
      <label>Client phone</label>
      <input id="cPhone" placeholder="+351 9xx ..." />
    </div>
    <div class="section">
      <label>Client email</label>
      <input id="cEmail" placeholder="client@example.com" />
      <div class="hint">Fields are saved on this device only.</div>
    </div>
    <div class="section">
      <a class="btn primary" id="sendWA" target="_blank">üí¨ Send WhatsApp</a>
      <a class="btn secondary" id="sendSMS">üì± Send SMS</a>
      <a class="btn secondary" id="sendEmail">‚úâÔ∏è Send Email</a>
      <button class="btn secondary" id="copyLink">üîó Copy Link</button>
      <button class="btn tertiary" id="toggleQR">üßæ Show QR</button>
    </div>
    <div class="section" id="qrWrap" style="display:none">
      <div id="qrcode" style="background:#fff;padding:10px;border-radius:12px;display:inline-block"></div>
    </div>
    <div class="section">
      <button class="btn tertiary" id="nfcWrite">üì∂ Write NFC Tag</button>
      <div class="hint">Android Chrome supports Web NFC. Tap an NFC tag to write your card URL.</div>
    </div>
    <div class="footer">¬© 2025 Century 21 Forever Homes ‚Ä¢ Powered by 2F</div>
  </div>
</div>
<script>
if("serviceWorker" in navigator){ navigator.serviceWorker.register("./sw.js"); }
const $=id=>document.getElementById(id);
const enc=s=>encodeURIComponent(s);
const params = new URLSearchParams(location.search);
const localIdKey = "consultant_id";
const id = params.get("id") || localStorage.getItem(localIdKey) || "fredrik";
localStorage.setItem(localIdKey, id);

async function fetchSupabase(id){
  const {SUPABASE_URL, SUPABASE_ANON} = window.CONFIG || {};
  if(!SUPABASE_URL || !SUPABASE_ANON) return null;
  const url = SUPABASE_URL + "/rest/v1/consultants?id=eq." + encodeURIComponent(id) + "&select=*";
  const res = await fetch(url, { headers: { apikey: SUPABASE_ANON, Authorization: "Bearer " + SUPABASE_ANON } });
  if(!res.ok) return null;
  const rows = await res.json();
  return rows && rows[0] ? rows[0] : null;
}
async function fetchLocal(id){
  try{ const one = await fetch("./data/" + id + ".json"); if(one.ok) return await one.json(); }catch(e){}
  try{ const idx = await fetch("./data/consultants.json"); if(!idx.ok) return null; const j = await idx.json(); const m = (j.consultants||[]).find(c=>c.id===id) || (j.consultants||[])[0]; return m || null; }catch(e){}
  return null;
}
function setProfile(p){
  if(!p) return;
  $("myName").textContent = p.name || "";
  $("myEmail").textContent = p.email || "";
  $("myPhone").textContent = p.phone || "";
  $("myCard").textContent  = p.card_link || "";
  if(p.avatar){ $("myAvatar").style.backgroundImage = "url(" + p.avatar + ")"; }
}
function loadClientFields(){ $("cPhone").value = localStorage.getItem("cPhone") || ""; $("cEmail").value = localStorage.getItem("cEmail") || ""; }
function saveClientFields(){ localStorage.setItem("cPhone", $("cPhone").value.trim()); localStorage.setItem("cEmail", $("cEmail").value.trim()); }
["cPhone","cEmail"].forEach(x=>$(x).addEventListener("input", saveClientFields));
function getCardURL(){ return $("myCard").textContent.trim(); }
function waLink(phone,url){ const num=(phone||"").replace(/\D/g,""); const text="Hi, here is my digital business card: " + url; return "https://wa.me/" + (num?num:"") + "?text=" + enc(text); }
function smsLink(phone,url){ return "sms:" + (phone||"") + "?&body=" + enc("Here is my digital business card: " + url); }
function mailLink(email,url,agent){ const subj=enc("My digital business card"); const body=enc("Hi,\n\nThis is my digital business card: " + url + "\n\nBest, " + (agent||"")); return "mailto:" + (email||"") + "?subject=" + subj + "&body=" + body; }
$("sendWA").addEventListener("click", e=> e.currentTarget.href = waLink($("cPhone").value, getCardURL()));
$("sendSMS").addEventListener("click", e=> e.currentTarget.href = smsLink($("cPhone").value, getCardURL()));
$("sendEmail").addEventListener("click", e=> e.currentTarget.href = mailLink($("cEmail").value, getCardURL(), $("myName").textContent));
$("copyLink").addEventListener("click", async ()=>{ try{ await navigator.clipboard.writeText(getCardURL()); alert("Link copied"); }catch{ alert("Copy failed"); }});
function drawFakeQR(text){ const el=$("qrcode"); el.innerHTML=""; const c=document.createElement("canvas"); c.width=240; c.height=240; el.appendChild(c); const ctx=c.getContext("2d"); ctx.fillStyle="#fff"; ctx.fillRect(0,0,240,240); ctx.fillStyle="#000"; let hash=0; for(let i=0;i<text.length;i++) hash=(hash*31+text.charCodeAt(i))>>>0; const cells=33, size=Math.floor(240/cells); for(let y=0;y<cells;y++) for(let x=0;x<cells;x++){ if((hash>>((x*y)%31))&1) ctx.fillRect(x*size,y*size,size,size); } }
$("toggleQR").addEventListener("click", ()=>{ const w=$("qrWrap"); w.style.display=(w.style.display==="none"||!w.style.display)?"block":"none"; if(w.style.display==="block") drawFakeQR(getCardURL()); });
$("nfcWrite").addEventListener("click", async ()=>{ if("NDEFReader" in window){ try{ const ndef=new NDEFReader(); await ndef.write({records:[{recordType:"url", data:getCardURL()}]}); alert("NFC tag written."); } catch(e){ alert("NFC write failed: " + e.message); } } else { alert("Web NFC not supported on this device/browser."); } });

(async ()=>{ loadClientFields(); let p = await fetchSupabase(id); if(!p) p = await fetchLocal(id); setProfile(p); })();
</script>
</body></html>
